## 进程管理

### 进程间通信 {#进程间通信}

#### **传统的Unix通信机制**

1. 管道/匿名管道\(pipe\)

2. 具名管道\(FIFO\)

3. 信号\(Signal\)

4. 消息\(Message\)队列

5. 共享内存\(share memory\)

6. 信号量\(semaphore\)

7. 套接字\(socket\)

#### 管道

管道的实质是一个内核缓冲区，进程以先进先出的方式从缓冲区存取数据，管道一端的进程顺序的将数据写入缓冲区，另一端的进程则顺序的读出数据。

该缓冲区可以看做是一个循环队列，读和写的位置都是自动增长的，不能随意改变，一个数据只能被读一次，读出来以后在缓冲区就不复存在了。

当缓冲区读空或者写满时，有一定的规则控制相应的读进程或者写进程进入等待队列，当空的缓冲区有新数据写入或者满的缓冲区有数据读出来时，就唤醒等待队列中的进程继续读写。

##### 局限

* 只支持单向数据流
* 只能用于具有亲缘关系的进程之间
* 没有名字
* 管道的缓冲区是有限的（管道制存在于内存中，在管道创建时，为缓冲区分配一个页面大小）
* 管道所传送的是无格式字节流，这就要求管道的读出方和写入方必须事先约定好数据的格式

#### Linux常见信号

* `SIGHUP`：用户从终端注销，所有已启动进程都将收到该进程。系统缺省状态下对该信号的处理是终止进程。
* `SIGINT`：程序终止信号。程序运行过程中，按`Ctrl+C`键将产生该信号。
* `SIGQUIT`：程序退出信号。程序运行过程中，按`Ctrl+\`键将产生该信号。
* `SIGBUS`和`SIGSEGV`：程访问非法地址。
* `SIGFPE`：运算中出现致命错误，如除零操作、数据溢出等。
* `SIGKILL`：用户终止进程执行信号。shell下执行`kill -9`发送该信号。
* `SIGTERM`：结束进程信号。shell下执行`kill pid`发送该信号。
* `SIGALRM`：定时器信号。
* `SIGCLD`：子进程退出信号。如果其父进程没有忽略该信号也没有处理该信号，则子进程退出后将形成僵尸进程。

### 进程与线程

**进程**是具有一定独立功能的程序、它是系统进行资源分配和调度的一个独立单位，重点在系统调度和单独的单位，也就是说进程是可以独立运行的一段程序。

**线程**是进程的一个实体，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位，线程自己基本上不拥有系统资源。在运行时，只是暂用一些计数器、寄存器和栈 。

#### 关系

1. 一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程（通常说的主线程）。
2. 资源分配给进程，同一进程的所有线程共享该进程的所有资源。
3. 线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。
4. 处理机分给线程，即真正在处理机上运行的是线程。
5. 线程是指进程内的一个执行单元，也是进程内的可调度实体。

#### 区别

* **调度**：线程作为调度和分配的基本单位，进程作为拥有资源的基本单位。
* **并发性**：不仅进程之间可以并发执行，同一个进程的多个线程之间也可以并发执行。
* **拥有资源**：进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源。
