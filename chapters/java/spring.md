## Spring

### 特点

1. 控制反转（IoC，Inversion of Control）功能，在解耦上达到了配置级别
2. 对数据库访问事务相关的封装
3. 各种其他组件与Spring的融合，在Spring中更加方便快捷的继承其他一些组件

### 配置Bean方式

1. 基于XML文件进行配置。 
2. 基于注解进行配置。 
3. 基于Java程序进行配置（Spring 3+）

### 控制反转（IoC）和依赖注入（DI）

#### 控制反转（IoC）

`IOC`是Inversion of Control的缩写，“控制反转”之意。

软件系统在没有引入IOC容器之前，对象A依赖于对象B，那么对象A在初始化或者运行到某一点的时候，自己必须主动去创建对象B或者使用已经创建的对象B。无论是创建还是使用对象B，控制权都在自己手上。

软件系统在引入IOC容器之后，这种情形就完全改变了，由于IOC容器的加入，对象A与对象B之间失去了直接联系，所以，当对象A运行到需要对象B的时候，IOC容器会主动创建一个对象B注入到对象A需要的地方。

通过前后的对比，我们不难看出来：对象A获得依赖对象B的过程,由主动行为变为了被动行为，控制权颠倒过来了，这就是“控制反转”这个名称的由来。

#### 依赖注入（DI）

> 获得依赖对象的过程被反转

控制被反转之后，获得依赖对象的过程由自身管理变为了由`IoC`容器主动注入。依赖注入\(DI\)和控制反转\(IOC\)是从不同的角度的描述的同一件事情，就是指通过引入IOC容器，利用依赖关系注入的方式，实现对象之间的解耦。

#### 优点

1. 降低类之间耦合，可维护性比较好，非常便于进行单元测试，便于调试程序和诊断故障
2. 模块之间通过接口交流，互不干扰，便于团队开发
3. 可复用性好
4. 模块具有热插拔特性，可直接修改配置文件

#### 缺点

1. 引入了第三方控制反转容器，生成对象的步骤变得有些复杂
2. 控制反转容器生成对象是通过反射方式，在运行效率上有一定的损耗
3. 额外的配置工作。

### 事务

#### 传播行为

事务的第一个方面是传播行为。传播行为定义关于客户端和被调用方法的事务边界。Spring定义了7种传播行为。

| **传播行为** | **意义** |
| :---: | :---: |
| `PROPAGATION_MANDATORY` | 表示该方法必须运行在一个事务中。如果当前没有事务正在发生，将抛出一个异常 |
| `PROPAGATION_NESTED` | 表示如果当前正有一个事务在进行中，则该方法应当运行在一个嵌套式事务中。被嵌套的事务可以独立于封装事务进行提交或回滚。如果封装事务不存在，行为就像`PROPAGATION_REQUIRES`一样。  |
| `PROPAGATION_NEVER` | 表示当前的方法不应该在一个事务中运行。如果一个事务正在进行，则会抛出一个异常。  |
| `PROPAGATION_NOT_SUPPORTED` | 表示该方法不应该在一个事务中运行。如果一个现有事务正在进行中，它将在该方法的运行期间被挂起。  |
| `PROPAGATION_SUPPORTS` | 表示当前方法不需要事务性上下文，但是如果有一个事务已经在运行的话，它也可以在这个事务里运行。  |
| `PROPAGATION_REQUIRES_NEW` | 表示当前方法必须在它自己的事务里运行。一个新的事务将被启动，而且如果有一个现有事务在运行的话，则将在这个方法运行期间被挂起。  |
| `PROPAGATION_REQUIRES` | 表示当前方法必须在一个事务中运行。如果一个现有事务正在进行中，该方法将在那个事务中运行，否则就要开始一个新事务。|

传播规则回答了这样一个问题，就是一个新的事务应该被启动还是被挂起，或者是一个方法是否应该在事务性上下文中运行。

#### 隔离级别

考虑到完全隔离会影响性能，而且并不是所有应用程序都要求完全隔离，所以有时可以在事务隔离方面灵活处理。因此，就会有好几个隔离级别。

| **隔离级别** | **含义** |
| :---: | :---: |
| `ISOLATION_DEFAULT` | 使用后端数据库默认的隔离级别。|
| `ISOLATION_READ_UNCOMMITTED` | 允许读取尚未提交的更改。可能导致脏读、幻影读或不可重复读。|
| `ISOLATION_READ_COMMITTED` | 允许从已经提交的并发事务读取。可防止脏读，但幻影读和不可重复读仍可能会发生。|
| `ISOLATION_REPEATABLE_READ` | 对相同字段的多次读取的结果是一致的，除非数据被当前事务本身改变。可防止脏读和不可重复读，但幻影读仍可能发生。|
| `ISOLATION_SERIALIZABLE` | 完全服从ACID的隔离级别，确保不发生脏读、不可重复读和幻影读。这在所有隔离级别中也是最慢的，因为它通常是通过完全锁定当前事务所涉及的数据表来完成的。|

### 面向切面编程（AOP）

AOP（Aspect-Oriented Programming）指一种程序设计范型，该范型以一种称为切面（aspect）的语言构造为基础，切面是一种新的模块化机制，用来描述分散在对象、类或方法中的横切关注点（crosscutting concern）。

关注点是应用中一个模块的行为，一个关注点可能会被定义成一个我们想实现的一个功能。横切关注点是一个关注点，此关注点是整个应用都会使用的功能，并影响整个应用，比如日志，安全和数据传输，几乎应用的每个模块都需要的功能。因此这些都属于横切关注点。

#### 连接点

连接点代表一个应用程序的某个位置，在这个位置我们可以插入一个AOP切面，它实际上是个应用程序执行Spring AOP的位置。

#### 通知

通知是个在方法执行前或执行后要做的动作，实际上是程序执行时要通过Spring AOP框架触发的代码段。

Spring切面可以应用五种类型的通知：

1. `before`前置通知，在一个方法执行前被调用。
2. `after`在方法执行之后调用的通知，无论方法执行是否成功。
3. `after-returning`仅当方法成功完成后执行的通知。
4. `after-throwing`在方法抛出异常退出时执行的通知。
5. `around`在方法执行之前和之后调用的通知。

#### 切点

切入点是一个或一组连接点，通知将在这些位置执行。可以通过表达式或匹配的方式指明切入点。

**答疑一**：Spring框架中的单例Bean是线程安全的吗?

Spring框架中的单例bean**不是**线程安全的。

