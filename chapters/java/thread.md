## Java线程

### Java线程状态

Java线程模型定义了 6 种状态，在任意一个时间点，一个线程有且只有其中一个状态：

  * `新建（New）`：新建的Thread，尚未开始。
  * `运行（Runable）`：包含操作系统线程状态中的Running、Ready，也就是处于正在执行或正在等待CPU分配时间的状态。
  * `无限期等待（Waiting）`：处于这种状态的线程不会被分配CPU时间，等待其他线程唤醒。
  * `限期等待（Timed Waiting）`：处于这种状态的线程不会被分配CPU时间，在一定时间后会由系统自动唤醒。
  * `阻塞（Blocked）`：在等待获得排他锁。
  * `结束（Terminated）`：已终止的线程。
  
### Java线程状态切换

![](/assets/java-thread-states.svg)

### 创建线程

1. 继承Thread类
2. 通过Runnable接口
3. 通过Callable和Future创建线程

### 线程池

#### 作用

1. 减少了创建和销毁线程的次数，每个工作线程都可以被重复利用，可执行多个任务。
2. 可以根据系统的承受能力，调整线程池中工作线线程的数目，防止因为消耗过多的内存，而把服务器累趴下。

#### 组成

1. `线程池管理器（ThreadPool）`用于创建并管理线程池，包括 创建线程池，销毁线程池，添加新任务；
2. `工作线程（PoolWorker）`线程池中线程，在没有任务时处于等待状态，可以循环的执行任务；
3. `任务接口（Task）`每个任务必须实现的接口，以供工作线程调度任务的执行，它主要规定了任务的入口，任务执行完后的收尾工作，任务的执行状态等；
4. `任务队列（taskQueue）`用于存放没有处理的任务。提供一种缓冲机制。

### 常见线程池

1. `newSingleThreadExecutor`单个线程的线程池，即线程池中每次只有一个线程工作，单线程串行执行任务
2. `newFixedThreadExecutor(n)`固定数量的线程池，没提交一个任务就是一个线程，直到达到线程池的最大数量，然后后面进入等待队列直到前面的任务完成才继续执行
3. `newCacheThreadExecutor`可缓存线程池，当线程池大小超过了处理任务所需的线程，那么就会回收部分空闲（一般是60秒无执行）的线程，当有任务来时，又智能的添加新线程来执行
4. `newScheduleThreadExecutor`大小无限制的线程池，支持定时和周期性的执行线程

### 经验值

其中$$N$$为CPU的核心数

* 计算密集型应用，线程池大小设置为$$N+1$$
* 输入输出密集型应用，线程池大小设置为$$2N+1$$
